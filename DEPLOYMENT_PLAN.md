# План развертывания и архитектура проекта

## Архитектура системы

```
┌─────────────────────────────────────────────────────────────┐
│                      ПОЛЬЗОВАТЕЛИ                            │
└─────────────────────────────────────────────────────────────┘
                           │
           ┌───────────────┴───────────────┐
           │                               │
           ▼                               ▼
┌──────────────────────┐      ┌──────────────────────┐
│   TELEGRAM БОТ       │      │  САЙТ-ВИТРИНА        │
│   (Python/aiogram)   │      │  (Vercel/Next.js)    │
│                      │      │                      │
│  - Регистрация       │      │  - Каталог услуг     │
│  - Просмотр галереи  │      │  - Каталог товаров   │
│  - Заказ услуг       │      │  - Галерея           │
│  - Заказ цветов      │      │  - Онлайн-заказ      │
│  - Техподдержка      │      │  - Контакты          │
└──────────┬───────────┘      └──────────┬───────────┘
           │                              │
           │    ┌─────────────────────────┘
           │    │
           ▼    ▼
┌─────────────────────────────────────────────────────────────┐
│              ОБЩАЯ БАЗА ДАННЫХ (SQLite)                      │
│  - users                                                     │
│  - services (категории и услуги)                            │
│  - products (товары/цветы)                                  │
│  - gallery (фото для бота и сайта)                          │
│  - salon_appointments                                        │
│  - flower_orders                                             │
└─────────────────────────────────────────────────────────────┘
           ▲
           │
┌──────────┴───────────┐
│  АДМИН-ПАНЕЛЬ        │
│  (Flask)             │
│                      │
│  - Галерея           │
│  - Категории услуг   │
│  - Карточки услуг    │
│  - Товары/цветы      │
│  - Заказы            │
│  - Пользователи      │
│  - Техподдержка      │
└──────────────────────┘
```

## Что нужно для деплоя

### Необходимые файлы:
```
beauty_salon_bot/
├── main.py                    ✅ Бот
├── admin_app.py               ✅ Админ-панель
├── database.py                ✅ База данных
├── config.py                  ✅ Конфигурация
├── alerts.py                  ✅ Уведомления
├── daily_report.py            ✅ Отчеты
├── feedback_scheduler.py      ✅ Сбор отзывов
├── requirements.txt           ✅ Зависимости
├── .env                       ✅ Переменные окружения
├── README.md                  ✅ Документация
├── handlers/                  ✅ Обработчики бота
├── templates/                 ✅ Шаблоны админки
├── static/                    ✅ Статика
└── utils/                     ✅ Утилиты
```

### Файлы для удаления (не нужны для деплоя):
```
❌ SETUP_INSTRUCTIONS.md       - документация разработки
❌ LAUNCH_CHECKLIST.md          - чеклист разработки
❌ TESTING_GUIDE.md             - гайд по тестированию
❌ TROUBLESHOOTING.md           - траблшутинг
❌ QUICK_START.md               - быстрый старт (дубликат)
❌ PRIVACY_POLICY.md            - политика (можно на сайте)
❌ CONSENT.md                   - согласие (можно на сайте)
❌ TELEGRAM_GROUP_SETUP.md      - инструкция по настройке
❌ ADMIN_PANEL_GUIDE.md         - гайд (старый)
❌ REFERRAL_UTM_SYSTEM.md       - функционал который удалили
❌ UTM_REFERRAL_QUICKSTART.md   - функционал который удалили
❌ DAILY_REPORTS_GUIDE.md       - гайд по отчетам
❌ MASTERS_CALENDAR_GUIDE.md    - функционал который удалили
❌ ADMIN_FULL_GUIDE.md          - старый гайд
❌ MVP_MIGRATION_STEPS.md       - инструкция миграции
❌ README_MVP.md                - старый readme

❌ seed_database.py             - тестовые данные
❌ test_utm_system.py           - тесты удаленного функционала
❌ test_metro_client.py         - тесты
❌ test_edge_cases.py           - тесты
❌ test_chaos_scenarios.py      - тесты
❌ run_all_tests.py             - тесты
❌ test_masters_scenarios.py    - тесты
❌ daily_report_scheduler.py    - дубликат (есть в alerts.py)
❌ admin_app_FULL_BACKUP.py     - бэкап
❌ cleanup_mvp.py               - скрипт миграции
❌ admin_app_mvp.py             - старая версия
❌ migrate_to_mvp.py            - скрипт миграции
```

## Структура для развертывания

### 1. Сервер (VPS/Dedicated)
```
/var/www/beauty_salon_bot/
├── main.py                    # Бот (systemd service)
├── admin_app.py               # Админка (nginx + gunicorn)
├── database.py
├── config.py
├── bot.db                     # База данных
├── .env                       # Секреты
├── venv/                      # Виртуальное окружение
├── handlers/
├── templates/
├── static/
└── utils/
```

**Сервисы:**
- `beauty-bot.service` - Telegram бот (порт не нужен)
- `beauty-admin.service` - Админ-панель (gunicorn на порту 8000)
- `nginx` - Веб-сервер (проксирует на порт 8000)

### 2. Vercel (Сайт-витрина)
```
beauty-salon-website/
├── pages/
│   ├── index.js               # Главная
│   ├── services.js            # Каталог услуг
│   ├── products.js            # Каталог цветов
│   └── gallery.js             # Галерея
├── components/
├── public/
├── api/
│   └── db.js                  # API для доступа к БД
└── package.json
```

**Доступ к данным:**
- Vercel сайт обращается к БД через API
- API может быть на том же сервере что и бот/админка
- Или использовать прямой доступ к БД через SQLite HTTP

## План действий

### Шаг 1: Очистка проекта
1. Удалить тестовые файлы
2. Удалить документацию разработки
3. Удалить скрипты миграции
4. Оставить только production файлы

### Шаг 2: Восстановление полной админ-панели
1. Восстановить admin_app.py из бэкапа
2. Добавить управление категориями услуг
3. Добавить управление карточками товаров
4. Добавить API endpoints для сайта

### Шаг 3: Создание API для сайта
1. Endpoint для получения категорий услуг
2. Endpoint для получения услуг
3. Endpoint для получения товаров
4. Endpoint для галереи
5. Endpoint для создания заказов

### Шаг 4: Настройка Vercel сайта
1. Создать Next.js приложение
2. Интегрировать с API
3. Добавить каталоги и галерею
4. Добавить форму заказа

## Вопросы для уточнения:

1. **Сайт на Vercel** - есть ли уже готовый сайт или нужно создать с нуля?
2. **Сервер** - есть ли уже арендованный сервер или нужен хостинг?
3. **Домен** - какой домен будет использоваться?
4. **База данных** - SQLite достаточно или нужна PostgreSQL?
5. **API** - где будет размещен API для сайта (на том же сервере с ботом)?
