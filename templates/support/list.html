{% extends "base.html" %}

{% block title %}–û–±—Ä–∞—â–µ–Ω–∏—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É{% endblock %}
{% block page_title %}–û–±—Ä–∞—â–µ–Ω–∏—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="row mb-3">
            <div class="col-md-3">
                <div class="card text-white bg-danger">
                    <div class="card-body">
                        <h5 class="card-title">‚ùó –ù–æ–≤—ã–µ</h5>
                        <h2 class="mb-0">{{ new_count }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-warning">
                    <div class="card-body">
                        <h5 class="card-title">üîÑ –í –æ–±—Ä–∞–±–æ—Ç–∫–µ</h5>
                        <h2 class="mb-0">{{ in_progress_count }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-primary">
                    <div class="card-body">
                        <h5 class="card-title">üìä –í—Å–µ–≥–æ</h5>
                        <h2 class="mb-0">{{ total_count }}</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="card mb-3">
            <div class="card-body">
                <form method="get" class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">–°—Ç–∞—Ç—É—Å:</label>
                        <select name="status" class="form-select" onchange="this.form.submit()">
                            <option value="">–í—Å–µ</option>
                            <option value="new" {% if status == 'new' %}selected{% endif %}>–ù–æ–≤—ã–µ</option>
                            <option value="in_progress" {% if status == 'in_progress' %}selected{% endif %}>–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">&nbsp;</label><br>
                        <a href="{{ url_for('support_list') }}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
                    </div>
                </form>
            </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">–°–ø–∏—Å–æ–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π ({{ threads|length }})</h5>
            </div>
            <div class="card-body">
                {% if threads %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>User ID</th>
                                    <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                                    <th>–û—Ç–≤–µ—Ç–∏–ª–∏</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for thread in threads %}
                                    <tr>
                                        <td>
                                            {% if thread.status == 'new' %}
                                                <span class="badge bg-danger">‚ùó –ù–æ–≤–æ–µ</span>
                                            {% elif thread.status == 'in_progress' %}
                                                <span class="badge bg-warning">‚úÖ –í —Ä–∞–±–æ—Ç–µ</span>
                                            {% else %}
                                                <span class="badge bg-secondary">{{ thread.status }}</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <strong>{{ thread.user_name }}</strong>
                                        </td>
                                        <td>
                                            <code>{{ thread.user_id }}</code>
                                        </td>
                                        <td>
                                            {{ thread.created_at[:19] if thread.created_at else 'N/A' }}
                                        </td>
                                        <td>
                                            {% if thread.responded %}
                                                <span class="text-success">‚úÖ –î–∞</span>
                                            {% else %}
                                                <span class="text-danger">‚ùå –ù–µ—Ç</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <a href="{{ url_for('user_detail', user_id=thread.user_id) }}"
                                               class="btn btn-sm btn-primary"
                                               title="–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                                                <i class="bi bi-person"></i>
                                            </a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> –ù–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π
                        {% if status %}–ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É{% endif %}
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="card mt-3">
            <div class="card-body">
                <h6><i class="bi bi-info-circle"></i> –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</h6>
                <ul class="mb-0">
                    <li><strong>‚ùó –ù–æ–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ</strong> - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É, —Ç–æ–ø–∏–∫ —Å–æ–∑–¥–∞–Ω –≤ Telegram</li>
                    <li><strong>‚úÖ –í —Ä–∞–±–æ—Ç–µ</strong> - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ (—Ç–æ–ø–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω)</li>
                    <li><strong>‚ö†Ô∏è –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</strong> - –µ—Å–ª–∏ –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –º–∏–Ω—É—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ —Ç–æ–ø–∏–∫</li>
                    <li><strong>Telegram</strong> - –≤—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ —Ç–æ–ø–∏–∫–∏ –≤ –≤–∞—à–µ–π –∞–¥–º–∏–Ω-–≥—Ä—É–ø–ø–µ</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
